# 테이블 생성
```sql
CREATE TABLE Student (
    student_id   INT AUTO_INCREMENT PRIMARY KEY,
    name         VARCHAR(50) NOT NULL,
    email        VARCHAR(100) NOT NULL UNIQUE,
    phone        VARCHAR(20),
    reg_date     DATETIME DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE Course (
    course_id   INT AUTO_INCREMENT PRIMARY KEY,
    title       VARCHAR(100) NOT NULL,
    instructor  VARCHAR(50) NOT NULL,
    fee         INT NOT NULL CHECK (fee >= 0),
    opened_at   DATE NOT NULL
);
CREATE TABLE Enrollment (
    enrollment_id   INT AUTO_INCREMENT PRIMARY KEY,
    student_id      INT NOT NULL,
    course_id       INT NOT NULL,
    enrolled_at     DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    payment_status  ENUM('PAID', 'CANCEL') NOT NULL,
    CONSTRAINT fk_enroll_student
        FOREIGN KEY (student_id)
        REFERENCES Student(student_id)
        ON DELETE CASCADE,
    CONSTRAINT fk_enroll_course
        FOREIGN KEY (course_id)
        REFERENCES Course(course_id)
        ON DELETE CASCADE
);
CREATE TABLE Exam (
    exam_id     INT AUTO_INCREMENT PRIMARY KEY,
    course_id   INT NOT NULL,
    exam_name   VARCHAR(100) NOT NULL,
    exam_date   DATE NOT NULL,
    CONSTRAINT fk_exam_course
        FOREIGN KEY (course_id)
        REFERENCES Course(course_id)
        ON DELETE CASCADE
);
CREATE TABLE Score (
    score_id    INT AUTO_INCREMENT PRIMARY KEY,
    student_id  INT NOT NULL,
    exam_id     INT NOT NULL,
    score       INT,
    CONSTRAINT fk_score_student
        FOREIGN KEY (student_id)
        REFERENCES Student(student_id)
        ON DELETE CASCADE,
    CONSTRAINT fk_score_exam
        FOREIGN KEY (exam_id)
        REFERENCES Exam(exam_id)
        ON DELETE CASCADE
);
```
## 외래키 제약 조건 예시
```sql
CREATE TABLE Member (
    id INT PRIMARY KEY,
    name VARCHAR(100)
);

CREATE TABLE Orders (
    id INT PRIMARY KEY,
    member_id INT,
    FOREIGN KEY (member_id) REFERENCES Member(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```
## 컬럼 추가
```sql
ALTER TABLE Student ADD birth_date DATE;
```
## 컬럼 변경
```sql
ALTER TABLE Course MODIFY instructor VARCHAR(80) NOT NULL;
```
## 테이블 이름 변경
```sql
ALTER TABLE Exam RENAME TO ExamInfo;
```
## 제약조건 추가
```sql
ALTER TABLE score ADD CONSTRAINT score_ck CHECK (score BETWEEN 0 AND 100);
```
## insert 예시
```sql
INSERT INTO Student (name, email, phone)VALUES
('김학생', 'kim@student.com', '010-1111-1111'),
('이학생', 'lee@student.com', '010-2222-2222'),
('박학생', 'park@student.com', '010-3333-3333'),
('최학생', 'choi@student.com', '010-4444-4444'),
('정학생', 'jung@student.com', '010-5555-5555');

INSERT INTO Course (title, instructor, fee, opened_at)VALUES
('SQL 기본', '홍강사', 80000, '2025-01-10'),
('데이터 모델링', '이강사', 100000, '2025-01-15'),
('고급 SQL', '박강사', 120000, '2025-01-20');

INSERT INTO ExamInfo (course_id, exam_name, exam_date)VALUES
(1, 'SQL 중간고사', '2025-02-01'),
(1, 'SQL 기말고사', '2025-02-20'),
(2, '모델링 평가', '2025-02-10');

INSERT INTO Enrollment (student_id, course_id, payment_status)
VALUES (1, 1, 'PAID'),(2, 1, 'PAID'),(3, 2, 'CANCEL'),(4, 2, 'PAID'),(5, 3, 'PAID');

INSERT INTO Score (student_id, exam_id, score)
VALUES (1, 1, 95),(2, 1, 82),(3, 3, 76),(4, 3, 88),(5, 2, 90);
```
## Update/Delete
```sql
UPDATE Enrollment SET payment_status = 'PAID' WHERE payment_status = 'CANCEL';

DELETE FROM Course WHERE fee >= 100000;

UPDATE Student SET email = 'kim.new@student.com' WHERE name = '김학생';
```
## LIKE
```sql
SELECT * FROM Student WHERE name LIKE '%김%';

SELECT email, SUBSTR(email, INSTR(email, '@') + 1) AS domain FROM Student;
```
## SUBSTR(Subtract String), LENGTH
```sql
SELECT email, SUBSTR(email, INSTR(email, '@') + 1) AS domain FROM Student;

SELECT title, LENGTH(title) AS title_length FROM Course;
```
## DATE_SUB, NOW
```sql
SELECT * FROM Enrollment WHERE enrolled_at >= DATE_SUB(NOW(), INTERVAL 7 DAY);

SELECT * FROM Student WHERE reg_date IS NULL;
```
## 집계함수 + GROUP BY + LEFT JOIN
```sql
SELECT s.student_id, s.name, AVG(sc.score) AS avg_score 
FROM student s
INNER JOIN score sc ON s.student_id = sc.student_id 
GROUP BY s.student_id, s.name;

SELECT c.course_id, c.title, c.fee, count(e.enrollment_id) AS student_count, c.fee * count(e.enrollment_id) AS total_revenue
FROM course c 
JOIN enrollment e ON c.course_id = e.course_id 
WHERE e.payment_status = 'PAID'
group by c.course_id, c.title, c.fee;

SELECT instructor, COUNT(*) AS course_count 
FROM course 
GROUP BY instructor;

SELECT ei.exam_id, ei.exam_name, MAX(sc.score) AS max_score, MIN(sc.score) AS min_score
FROM examInfo ei 
JOIN score sc ON ei.exam_id = sc.exam_id
GROUP BY ei.exam_id, ei.exam_name;
```

## inner/left join
```sql
SELECT s.name AS student_name, c.title AS course_title 
FROM student s
JOIN enrollment e ON s.student_id = e.student_id 
JOIN course c ON e.course_id = c.course_id;

SELECT s.student_id, s.name 
FROM student s 
LEFT JOIN enrollment e ON s.student_id = e.student_id 
WHERE e.enrollment_id IS NULL;

SELECT c.course_id, c.title 
FROM course c
LEFT JOIN examInfo ei ON c.course_id = ei.course_id 
WHERE ei.exam_id IS NULL

SELECT s.name AS student_name, c.title AS course_title, ei.exam_name, sc.score
FROM student s 
JOIN score sc ON s.student_id = sc.student_id -- R1(student join score)
JOIN examInfo ei ON sc.exam_id = ei.exam_id -- R2(R1 join examinfo)
JOIN course c ON ei.course_id = c.course_id; -- R3(R2 join course)
